---
import MainLayout from '../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';

const personajes = await getCollection('personajes');
const getImagePath = (slug: string) => `/personajes/${slug}.webp`;
const placeholderImg = "https://placehold.co/600x600/e2e8f0/475569?text=Sin+Imagen";
---
<MainLayout>

    <div class="max-w-[1600px] mx-auto px-6 py-12">
        <header class="mb-12 text-center">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Personajes</h1>
            <p class="text-gray-500">Registro oficial de sujetos de inter√©s.</p>
        </header>
        <div class="columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-6 space-y-6">
            
            {personajes.map((p) => (
                <div 
                    class="break-inside-avoid group cursor-pointer"
                    onclick={`openModal('${JSON.stringify({
                        nombre: p.data.nombre,
                        alias: p.data.alias || 'Desconocido',
                        colorHex: p.data.colorHex,
                        descripcion: p.data.descripcion,
                        img: getImagePath(p.slug) 
                    }).replace(/"/g, "&quot;")}')`} 
                >
                    <div class="relative rounded-2xl overflow-hidden bg-gray-100 shadow-sm hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                        <img 
                            src={getImagePath(p.slug)} 
                            alt={p.data.nombre}
                            class="w-full h-auto object-cover"
                            onerror={`this.src='${placeholderImg}'`}
                        />

                        <!-- Overlay al Hover -->
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-6">
                            <div class="text-white transform translate-y-4 group-hover:translate-y-0 transition-transform">
                                <span class="text-xs font-bold uppercase tracking-wider block opacity-80">{p.data.alias}</span>
                                <h3 class="text-xl font-bold">{p.data.nombre}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            ))}

        </div>

    </div>